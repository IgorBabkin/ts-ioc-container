---
layout: ../layouts/BaseLayout.astro
title: Registration
description: Registration - Registering providers with keys and scopes
---

import CodeBlock from "../components/CodeBlock.astro";
import registrationFlowDiagram from "../diagrams/registration-flow.mermaid?raw";
import registrationSpecCode from "../../../__tests__/readme/registration.spec.ts?raw";
import containerModuleSpecCode from "../../../__tests__/readme/containerModule.spec.ts?raw";

# Registration

Registrations connect providers to the container with keys and configuration. They can be created using decorators or the fluent API, providing flexibility in how you organize your dependency configuration.

<h2 id="registration-flow">Registration Flow</h2>

The following diagram shows how registrations are processed and applied to containers:

<div class="diagram">
  <div class="mermaid" set:html={registrationFlowDiagram} />
</div>

<h2 id="registration-methods">Registration Methods</h2>

There are several ways to create and apply registrations:

- **Decorator-based**: Using `@register` decorator
- **Fluent API**: Using `Registration` class methods
- **Direct registration**: Using `container.register()`

<h2 id="decorator-based-registration">Decorator-Based Registration</h2>

The `@register` decorator provides a declarative way to register classes. This is the most convenient approach for most use cases.

<CodeBlock code={registrationSpecCode} lang="typescript" filename="__tests__/readme/registration.spec.ts" />

<h2 id="fluent-api-registration">Fluent API Registration</h2>

The fluent API provides more control and is useful when you need dynamic registration or want to avoid decorators.

<CodeBlock code={registrationSpecCode} lang="typescript" filename="__tests__/readme/registration.spec.ts" />

<h2 id="keys">Keys</h2>

Keys identify dependencies in the container. They can be strings, symbols, or tokens. Understanding how keys work is essential for effective dependency management.

<CodeBlock code={registrationSpecCode} lang="typescript" filename="__tests__/readme/registration.spec.ts" />

<h2 id="scope-registration">Scope Registration</h2>

Scope match rules (`ScopeMatchRule`) control which scopes a provider is available in. This allows you to register different implementations for different environments or contexts.

<CodeBlock code={registrationSpecCode} lang="typescript" filename="__tests__/readme/registration.spec.ts" />

<h2 id="registration-pipeline">Registration Pipeline</h2>

Registrations support the pipeline pattern, allowing you to chain multiple transformations:

<CodeBlock code={`import { args, singleton, scopeAccess } from 'ts-ioc-container';

const container = new Container()
  .addRegistration(
    R.fromClass(ConfigService)
      .bindToKey('IConfig')
      .when((s) => s.hasTag('root'))
      .pipe(args('/config.json'))
      .pipe(singleton())
      .pipe(scopeAccess(({ invocationScope }) => invocationScope.hasTag('admin')))
  );`} lang="typescript" />

<h2 id="container-modules">Container Modules</h2>

Container modules encapsulate registration logic, making it easy to organize and compose your dependency configuration.

<CodeBlock code={containerModuleSpecCode} lang="typescript" filename="__tests__/readme/containerModule.spec.ts" />

<h2 id="best-practices">Best Practices</h2>

- **Use decorators for simple cases** - When you have straightforward class registrations
- **Use fluent API for dynamic registration** - When keys or providers are determined at runtime
- **Always provide keys for values/factories** - Required to avoid errors
- **Use modules for organization** - Group related registrations together
- **Use scope match rules for environment-specific code** - Keep configurations clean
- **Export tokens as constants** - Create keys once and reuse them
- **Use aliases for grouping** - When you need multiple implementations

<h2 id="registration-lifecycle">Registration Lifecycle</h2>

1. **Creation**: Registration is created with a provider
2. **Configuration**: Keys, scopes, and features are configured
3. **Application**: Registration is applied to container via `addRegistration()`
4. **Validation**: Scope match rules are evaluated
5. **Storage**: Provider is stored in container's provider map
6. **Alias Registration**: Aliases are registered if provided