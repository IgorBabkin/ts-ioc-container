---
import BaseLayout from "../layouts/BaseLayout.astro";
import CodeBlock from "../components/CodeBlock.astro";
import architectureDiagram from "../diagrams/architecture-overview.mermaid?raw";
import classDiagram from "../diagrams/class-diagram.mermaid?raw";
---

<BaseLayout
  title="Overview"
  description="Overview - Core architecture and class diagrams of the IoC container"
>
  <article>
    <h1>TypeScript IoC Container</h1>

    <h2>Advantages</h2>
    <ul>
      <li>battle tested</li>
      <li>written on <code>typescript</code></li>
      <li>simple and lightweight</li>
      <li>clean API</li>
      <li>supports <code>tagged scopes</code></li>
      <li>fully test covered</li>
      <li>can be used with decorators <code>@inject</code></li>
      <li>can inject properties</li>
      <li>can inject lazy dependencies</li>
      <li>composable and open to extend</li>
    </ul>

    <h2>Quick Start</h2>
    <CodeBlock
      code="npm install ts-ioc-container reflect-metadata"
      lang="bash"
    />

    <CodeBlock code="yarn add ts-ioc-container reflect-metadata" lang="bash" />

    <p>Put this in your entrypoint file (should be the first line):</p>
    <CodeBlock code="import 'reflect-metadata';" lang="typescript" />

    <p>Configure <code>tsconfig.json</code>:</p>
    <CodeBlock
      code={`{
  "compilerOptions": {
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true
  }
}`}
      lang="json"
    />

    <p>Creating and using a container:</p>

    <CodeBlock
      code={`import { Container, inject, Registration as R } from 'ts-ioc-container';

// Define your service
class Logger {
  log(message: string) {
    console.log(message);
  }
}

// Define a class that depends on Logger
class App {
  constructor(@inject('ILogger') private logger: Logger) {}

  run() {
    this.logger.log('Hello, IoC!');
  }
}

// Create and configure container
const container = new Container()
  .addRegistration(R.fromClass(Logger).bindToKey('ILogger'));

// Resolve and use
const app = container.resolve(App);
app.run(); // Output: Hello, IoC!`}
      lang="typescript"
    />

    <h2>Documentation</h2>
    <p>
      Browse the documentation chapters in the navigation menu to learn about:
    </p>
    <ul>
      <li>
        <strong><a href="/ts-ioc-container/">Overview</a></strong> - Core
        architecture and class diagrams
      </li>
      <li>
        <strong><a href="/ts-ioc-container/container">Container</a></strong> - Core
        container functionality, scopes, and instance management
      </li>
      <li>
        <strong
          ><a href="/ts-ioc-container/registration">Registration</a></strong
        > - Registering providers with keys and scopes
      </li>
      <li>
        <strong><a href="/ts-ioc-container/provider">Provider</a></strong> - Dependency
        factories with singleton, args, visibility, alias, and decorator features
      </li>
      <li>
        <strong><a href="/ts-ioc-container/injector">Injector</a></strong> - Different
        injection strategies (Metadata, Simple, Proxy)
      </li>
      <li>
        <strong><a href="/ts-ioc-container/token">Token</a></strong> - Token types
        for dependency keys (InjectionToken, IDToken, ClassToken, etc.)
      </li>
    </ul>

    <h2>Core Architecture</h2>

    <p>
      This chapter provides an overview of the core architecture and design of
      the TypeScript IoC container library. Understanding these concepts will
      help you make the most of the library's features.
    </p>

    <p>
      The IoC container is built on four fundamental abstractions that work
      together to provide dependency injection:
    </p>

    <ul>
      <li>
        <strong>Container</strong>: Manages the lifecycle and resolution of
        dependencies
      </li>
      <li>
        <strong>Provider</strong>: Factory that creates dependency instances
      </li>
      <li>
        <strong>Injector</strong>: Determines how dependencies are injected into
        constructors
      </li>
      <li>
        <strong>Registration</strong>: Connects providers to containers with
        keys and configuration
      </li>
    </ul>

    <h3>Architecture Overview</h3>

    <div class="diagram">
      <div class="mermaid" set:html={architectureDiagram} />
    </div>

    <h2>Class Diagram</h2>

    <p>
      The following diagram shows the main classes and interfaces and their
      relationships:
    </p>

    <div class="diagram">
      <div class="mermaid" set:html={classDiagram} />
    </div>
  </article>
</BaseLayout>

<style>
  .diagram {
    margin: 2rem 0;
    padding: 1.5rem;
    background: #f6f8fa;
    border: 1px solid #e1e4e8;
    border-radius: 8px;
    overflow-x: auto;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .diagram .mermaid {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 200px;
  }

  .diagram pre {
    margin: 0;
    background: transparent;
    border: none;
    padding: 0;
  }

  .diagram code {
    background: transparent;
    padding: 0;
  }
</style>
