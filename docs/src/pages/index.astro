---
import BaseLayout from "../layouts/BaseLayout.astro";
import CodeBlock from "../components/CodeBlock.astro";
import architectureDiagram from "../diagrams/architecture-overview.mermaid?raw";
import classDiagram from "../diagrams/class-diagram.mermaid?raw";
---

<BaseLayout
  title="Overview"
  description="Overview - Core architecture and class diagrams of the IoC container"
>
  <article>
    <h1>TypeScript IoC Container</h1>

    <h2 id="advantages" class="toc-link">Advantages</h2>
    <ul>
      <li>battle tested üí•</li>
      <li>written on <code>typescript</code></li>
      <li>simple and lightweight ‚ù§Ô∏è</li>
      <li>clean API üíö</li>
      <li>supports <code>tagged scopes</code></li>
      <li>fully test covered üíØ</li>
      <li>can be used with decorators <code>@inject</code></li>
      <li>can inject properties</li>
      <li>can inject lazy dependencies</li>
      <li>composable and open to extend</li>
    </ul>

    <h2 id="quick-start" class="toc-link">Quick Start</h2>
    <CodeBlock
      code="npm install ts-ioc-container reflect-metadata"
      lang="bash"
    />

    <CodeBlock code="yarn add ts-ioc-container reflect-metadata" lang="bash" />

    <p>Put this in your entrypoint file (should be the first line):</p>
    <CodeBlock code="import 'reflect-metadata';" lang="typescript" />

    <p>Configure <code>tsconfig.json</code>:</p>
    <CodeBlock
      code={`{
  "compilerOptions": {
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true
  }
}`}
      lang="json"
    />

    <p>Creating and using a container:</p>

    <CodeBlock
      code={`import { Container, inject, Registration as R } from 'ts-ioc-container';

// Define your service
class Logger {
  log(message: string) {
    console.log(message);
  }
}

// Define a class that depends on Logger
class App {
  constructor(@inject('ILogger') private logger: Logger) {}

  run() {
    this.logger.log('Hello, IoC!');
  }
}

// Create and configure container
const container = new Container()
  .addRegistration(R.fromClass(Logger).bindToKey('ILogger'));

// Resolve and use
const app = container.resolve(App);
app.run(); // Output: Hello, IoC!`}
      lang="typescript"
    />

    <h2 id="documentation">Documentation</h2>
    <p>
      Browse the documentation chapters in the navigation menu to learn about:
    </p>
    <ul>
      <li>
        <a href="/ts-ioc-container/">Overview</a> - Core
        architecture and class diagrams
      </li>
      <li>
        <a href="/ts-ioc-container/container">Container</a> - Core
        container functionality, scopes, and instance management
      </li>
      <li>
        <a href="/ts-ioc-container/registration">Registration</a> - Registering providers with keys and scopes
      </li>
      <li>
        <a href="/ts-ioc-container/provider">Provider</a> - Dependency
        factories with singleton, args, visibility, alias, and decorator features
      </li>
      <li>
        <a href="/ts-ioc-container/injector">Injector</a> - Different
        injection strategies (Metadata, Simple, Proxy)
      </li>
      <li>
        <a href="/ts-ioc-container/token">Token</a> - Token types
        for dependency keys (InjectionToken, SingleToken, GroupAliasToken, etc.)
      </li>
    </ul>

    <h2 id="core-architecture">Core Architecture</h2>

    <p>
      This chapter provides an overview of the core architecture and design of
      the TypeScript IoC container library. Understanding these concepts will
      help you make the most of the library's features.
    </p>

    <p>
      The IoC container is built on four fundamental abstractions that work
      together to provide dependency injection:
    </p>

    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">Container</h5>
            <p class="card-text">Manages the lifecycle and resolution of dependencies</p>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">Provider</h5>
            <p class="card-text">Factory that creates dependency instances</p>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">Injector</h5>
            <p class="card-text">Determines how dependencies are injected into constructors</p>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">Registration</h5>
            <p class="card-text">Connects providers to containers with keys and configuration</p>
          </div>
        </div>
      </div>
    </div>

    <h3>Architecture Overview</h3>

    <div class="diagram">
      <div class="mermaid" set:html={architectureDiagram} />
    </div>

    <h2 id="class-diagram">Class Diagram</h2>

    <p>
      The following diagram shows the main classes and interfaces and their
      relationships:
    </p>

    <div class="diagram">
      <div class="mermaid" set:html={classDiagram} />
    </div>
  </article>
</BaseLayout>

