---
import "bootstrap/dist/css/bootstrap.min.css";
import "../styles/global.scss";
import TableOfContents from "../components/TableOfContents.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { navigation } from "../config/navigation";
import { getHeadingsForPath } from "../config/headings";
import { themeColors } from "../config/theme";

interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "TypeScript IoC (Inversion Of Control) container library",
} = Astro.props;

// Get headings for current page
const headingsArray = getHeadingsForPath(Astro.url.pathname);

// Normalize pathnames for comparison
const normalizePath = (path: string) => path.replace(/\/$/, "") || "/";
const currentPath = normalizePath(Astro.url.pathname);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | ts-ioc-container</title>

    <style
      is:inline
      define:vars={{
        primaryLight: themeColors.light.primary,
        primaryRgbLight: themeColors.light.primaryRgb,
        primaryDark: themeColors.dark.primary,
        primaryRgbDark: themeColors.dark.primaryRgb,
      }}
    >
      :root {
        --bs-primary: var(--primaryLight);
        --bs-primary-rgb: var(--primaryRgbLight);
      }
      [data-bs-theme="dark"] {
        --bs-primary: var(--primaryDark);
        --bs-primary-rgb: var(--primaryRgbDark);
      }
    </style>

    <!-- Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Initialize theme before page render to prevent flash -->
    <script is:inline>
      (function () {
        const theme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        document.documentElement.setAttribute("data-bs-theme", theme);
      })();
    </script>
  </head>

  <body class="layout-body">
    <Header />

    <div class="layout-container">
      <aside class="layout-sidebar-left">
        <nav class="nav flex-column p-3">
          {
            navigation.map((item) => {
              const itemPath = normalizePath(item.href);
              const isActive =
                currentPath === itemPath ||
                (itemPath !== "/ts-ioc-container" &&
                  Astro.url.pathname.startsWith(item.href));
              return (
                <a
                  href={item.href}
                  class={`nav-link ${isActive ? "active bg-primary text-white" : ""}`}
                >
                  {item.title}
                </a>
              );
            })
          }
        </nav>
      </aside>

      <main class="layout-main">
        <slot />
      </main>

      <aside class="layout-sidebar-right">
        <TableOfContents headings={headingsArray} />
      </aside>
    </div>

    <Footer />

    <!-- Toast container for notifications -->
    <div
      class="toast-container position-fixed bottom-0 end-0 p-3"
      id="toast-container"
    >
    </div>

    <!-- Main client-side scripts -->
    <script>
      import "../scripts/main";
    </script>
  </body>
</html>
