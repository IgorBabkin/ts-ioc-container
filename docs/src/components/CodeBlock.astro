---
import { codeToHtml } from "shiki";
import CopyButton from "./CopyButton.astro";

interface Props {
  code: string;
  lang?:
    | "typescript"
    | "ts"
    | "javascript"
    | "js"
    | "json"
    | "shell"
    | "bash"
    | "sh";
  filename?: string;
}
const { code, lang = "typescript", filename } = Astro.props;

// Generate both light and dark HTML versions
const htmlLight = await codeToHtml(code, {
  lang,
  theme: "vitesse-light",
});

const htmlDark = await codeToHtml(code, {
  lang,
  theme: "vitesse-dark",
});
---

<div
  class="card mb-4"
>
  <div class="card-header d-flex justify-content-between align-items-center">
    {filename && <span class="font-monospace small">{filename}</span>}
    <CopyButton code={code} />
  </div>
  <div class="card-body p-0 code-block-content">
    <div class="code-block-light" set:html={htmlLight} />
    <div class="code-block-dark" set:html={htmlDark} />
  </div>
</div>

<style lang="css">
  .card-body :global(pre) {
    margin: 0;
    padding: 1rem;
    background: transparent;
    border: none;
    overflow-x: auto;
  }

  .card-body :global(code) {
    font-size: 0.875rem;
    display: block;
    width: 100%;
  }

  .code-block-content {
    position: relative;
  }

  .code-block-light,
  .code-block-dark {
    width: 100%;
  }

  :global([data-bs-theme="light"]) .code-block-dark {
    display: none !important;
  }

  :global([data-bs-theme="dark"]) .code-block-light {
    display: none !important;
  }

  :global([data-bs-theme="dark"]) .code-block-dark {
    display: block !important;
  }

  :global([data-bs-theme="light"]) .code-block-light {
    display: block !important;
  }
</style>
