---
interface Props {
  code: string;
}

const { code } = Astro.props;
---

<button
  class="btn btn-sm btn-outline-secondary code-copy-btn"
  data-code={code}
  aria-label="Copy code to clipboard"
  title="Copy to clipboard"
>
  <svg
    class="copy-icon"
    width="16"
    height="16"
    viewBox="0 0 16 16"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25v-7.5Z"
      fill="currentColor"></path>
    <path
      d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25v-7.5Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-7.5Z"
      fill="currentColor"></path>
  </svg>
  <svg
    class="check-icon d-none"
    width="16"
    height="16"
    viewBox="0 0 16 16"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 1.06-1.06L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"
      fill="currentColor"></path>
  </svg>
  <span class="copy-text">Copy</span>
  <span class="copied-text d-none">Copied!</span>
</button>

<style>
  .code-copy-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
  }

  .code-copy-btn.copied {
    background-color: var(--bs-success-bg-subtle);
    border-color: var(--bs-success);
    color: var(--bs-success);
  }

  .code-copy-btn.copied .copy-icon,
  .code-copy-btn.copied .copy-text {
    display: none !important;
  }

  .code-copy-btn.copied .check-icon,
  .code-copy-btn.copied .copied-text {
    display: inline-block !important;
  }
</style>

<script>
  function initCopyButton(button: HTMLElement) {
    if (button.dataset.initialized) return;
    button.dataset.initialized = "true";

    button.addEventListener("click", async function (this: HTMLElement) {
      const code = this.getAttribute("data-code");
      if (!code) return;

      await navigator.clipboard.writeText(code);

      // Add copied state
      this.classList.add("copied");

      // Reset after 2 seconds
      setTimeout(() => {
        this.classList.remove("copied");
      }, 2000);
    });
  }

  // Initialize copy buttons on this component
  const copyButtons = document.querySelectorAll<HTMLElement>(".code-copy-btn");
  copyButtons.forEach(initCopyButton);
</script>

